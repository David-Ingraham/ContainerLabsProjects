# Multi-Vendor BGP Lab with API Control

A containerlab project demonstrating multi-vendor BGP configuration using vendor APIs (FRR CLI and GoBGP gRPC) with Ansible automation. Works on both macOS and Windows/WSL.

## Topology

```
client1 (10.0.1.1) <---> frr1 (AS 65001) <---> gobgp1 (AS 65002) <---> client2 (10.0.3.2)
```

- **client1/client2**: Alpine Linux hosts
- **frr1**: FRRouting BGP router (configured via vtysh CLI)
- **gobgp1**: GoBGP router (configured via gRPC API)

## Project Structure

```
multiVendorAPI-BGP/
├── topology.yml                # Containerlab topology definition
├── bgp-config.yml             # Ansible playbook for BGP configuration
├── create-links.sh            # Network link creation script (macOS workaround)
├── clab-multi-vendor-api-bgp/ # Generated by containerlab
│   └── ansible-inventory.yml  # Auto-generated inventory
└── containerlabssetup.md      # Deployment commands reference
```

## Prerequisites

- Docker Desktop (running)
- Ansible (for macOS: `pip install ansible`, for WSL: `pip3 install ansible`)

## Quick Start

### 1. Deploy Containerlab Topology

**Bash (macOS/Linux/WSL):**
```bash
docker run --rm -it --privileged \
  --network host \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v $(pwd):/lab \
  -w /lab \
  ghcr.io/srl-labs/clab containerlab deploy -t topology.yml \
  --reconfigure
```

**PowerShell (Windows):**
```powershell
docker run --rm -it --privileged `
  --network host `
  -v /var/run/docker.sock:/var/run/docker.sock `
  -v ${PWD}:/lab `
  -w /lab `
  ghcr.io/srl-labs/clab containerlab deploy -t topology.yml `
  --reconfigure
```

### 2. Configure BGP via Ansible

**macOS:**
```bash
ansible-playbook -i clab-multi-vendor-api-bgp/ansible-inventory.yml bgp-config.yml
```

**WSL:**
```bash
wsl
cd /mnt/c/ContainerLabsProjects/multiVendorAPI-BGP
ansible-playbook -i clab-multi-vendor-api-bgp/ansible-inventory.yml bgp-config.yml
```

### 3. Verify BGP Sessions

```bash
# Check FRR1 BGP status
docker exec clab-multi-vendor-api-bgp-frr1 vtysh -c "show bgp summary"

# Check GoBGP1 neighbors
docker exec clab-multi-vendor-api-bgp-gobgp1 gobgp neighbor

# Test connectivity
docker exec clab-multi-vendor-api-bgp-client1 ping -c 3 10.0.3.2
```

### 4. Cleanup

**Bash:**
```bash
docker run --rm -it --privileged \
  --network host \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v $(pwd):/lab \
  -w /lab \
  ghcr.io/srl-labs/clab containerlab destroy -t topology.yml
```

**PowerShell:**
```powershell
docker run --rm -it --privileged `
  --network host `
  -v /var/run/docker.sock:/var/run/docker.sock `
  -v ${PWD}:/lab `
  -w /lab `
  ghcr.io/srl-labs/clab containerlab destroy -t topology.yml
```

## How It Works

1. **Topology Deployment**: Containerlab creates Docker containers and network links
2. **Link Creation**: 
   - macOS: Uses Alpine container with `iproute2` tools
   - WSL/Linux: Runs `create-links.sh` directly on host
3. **BGP Configuration**:
   - FRR1: Configured via vtysh CLI using `docker exec`
   - GoBGP1: Configured via gRPC API using `gobgp` CLI
4. **Route Injection**: Static routes added to clients for reachability testing

## Platform-Specific Notes

### macOS
- Network link creation runs in Alpine container due to missing Linux `iproute2` tools
- Docker Desktop provides Linux VM layer

### Windows/WSL
- Ansible must run from WSL (not native Windows)
- Network link creation runs directly in WSL environment
- Avoids container network connectivity issues

## Troubleshooting

**Docker not running:**
```
ERROR: The system cannot find the file specified
```
Solution: Start Docker Desktop

**Ansible SSH timeouts:**
```
Failed to connect to the host via ssh: Connection timed out
```
Solution: Ensure `gather_facts: no` in `bgp-config.yml` (Ansible uses `docker exec`, not SSH)

**Containerlab link creation fails on macOS:**
Use the `create-links.sh` script (already integrated in Ansible playbook)

## Key Features

- Multi-vendor BGP demonstration (FRR + GoBGP)
- API-driven configuration (CLI + gRPC)
- Cross-platform support (macOS/Windows/Linux)
- Automated with Ansible
- Self-documenting with inline comments

