all:
  vars:
    # Lab-level configuration
    lab_name: bgp-lab-multi-source
    
    # Multicast configuration
    multicast_rp: 10.1.0.2  # RP is frr1
    multicast_group: 239.1.1.1  # Primary group
    multicast_group_2: 239.1.1.2  # Secondary group
    
    # Router-to-router links
    router_links:
      - name: link-frr1-gobgp1
        subnet: 10.0.1.0/29
        endpoints:
          - router: frr1
            ip: 10.0.1.2
          - router: gobgp1
            ip: 10.0.1.3

  children:
    routers:
      children:
        frr_routers:
          vars:
            ansible_network_os: frr
            ansible_connection: network_cli
            ansible_host_key_checking: false
            
          hosts:
            # frr1: RP, FHR for both sources
            frr1:
              ansible_host: 10.1.1.11
              bgp_as: 65001
              bgp_router_id: 1.1.1.1
              
              bgp_neighbors:
                - neighbor: 10.0.1.3
                  remote_as: 65002
                  description: "gobgp1"
                - neighbor: 10.1.0.3
                  remote_as: 65003
                  description: "frr2"
              
              backend_network_name: frr1-network
              backend_ip: 10.1.0.2
              backend_subnet: 10.1.0.0/24
              backend_hosts:
                - name: host1
                  ip: 10.1.0.10
                - name: host3
                  ip: 10.1.0.30
                - name: frr2
                  ip: 10.1.0.3
              
              advertise_networks:
                - 10.1.0.0/24
              
              pim_interfaces:
                - eth1  # toward gobgp1
                - eth2  # toward frr1-network (sources + frr2)
              pim_rp_address: 10.1.0.2

            # frr2: LHR for receivers
            frr2:
              ansible_host: 10.1.1.12
              bgp_as: 65003
              bgp_router_id: 3.3.3.3
              
              bgp_neighbors:
                - neighbor: 10.1.0.2
                  remote_as: 65001
                  description: "frr1"
              
              backend_network_name: frr2-network
              backend_ip: 10.2.0.2
              backend_subnet: 10.2.0.0/24
              backend_hosts:
                - name: receiver1
                  ip: 10.2.0.10
                - name: receiver2
                  ip: 10.2.0.20
              
              advertise_networks:
                - 10.2.0.0/24
              
              pim_interfaces:
                - eth1  # toward frr1-network
                - eth2  # toward frr2-network (receivers)
              pim_rp_address: 10.1.0.2
              igmp_interfaces:
                - eth2

        gobgp_routers:
          hosts:
            gobgp1:
              ansible_host: 10.1.1.13
              bgp_as: 65002
              bgp_router_id: 2.2.2.2
              
              bgp_neighbors:
                - neighbor: 10.0.1.2
                  remote_as: 65001
                  description: "frr1"
              
              backend_network_name: gobgp-network
              backend_ip: 10.3.0.2
              backend_subnet: 10.3.0.0/24
              backend_hosts:
                - name: host2
                  ip: 10.3.0.10

    hosts_group:
      hosts:
        host1:
          ansible_host: 10.1.1.20
          role: multicast_source
          multicast_group: 239.1.1.1
          data_ip: 10.1.0.10
          gateway: 10.1.0.2
          connected_router: frr1

        host3:
          ansible_host: 10.1.1.26
          role: multicast_source
          multicast_group: 239.1.1.2
          data_ip: 10.1.0.30
          gateway: 10.1.0.2
          connected_router: frr1
          
        host2:
          ansible_host: 10.1.1.21
          role: endpoint
          data_ip: 10.3.0.10
          gateway: 10.3.0.2
          connected_router: gobgp1
          
        receiver1:
          ansible_host: 10.1.1.22
          role: multicast_receiver
          multicast_group: 239.1.1.1
          data_ip: 10.2.0.10
          gateway: 10.2.0.2
          connected_router: frr2
          
        receiver2:
          ansible_host: 10.1.1.23
          role: multicast_receiver_multi
          multicast_groups:
            - 239.1.1.1
            - 239.1.1.2
          data_ip: 10.2.0.20
          gateway: 10.2.0.2
          connected_router: frr2

