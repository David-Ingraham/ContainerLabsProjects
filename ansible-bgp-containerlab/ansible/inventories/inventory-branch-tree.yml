all:
  vars:
    # Lab-level configuration
    lab_name: bgp-lab-branch-tree
    
    # Multicast configuration
    multicast_rp: 10.1.0.2  # RP is frr1's backend interface
    multicast_group: 239.1.1.1
    
    # Router-to-router links
    router_links:
      - name: link-frr1-gobgp1
        subnet: 10.0.1.0/29
        endpoints:
          - router: frr1
            ip: 10.0.1.2
          - router: gobgp1
            ip: 10.0.1.3

  children:
    routers:
      children:
        frr_routers:
          vars:
            ansible_network_os: frr
            ansible_connection: network_cli
            ansible_host_key_checking: false
            
          hosts:
            # frr1: Main router, FHR, RP
            frr1:
              ansible_host: 10.1.1.11
              bgp_as: 65001
              bgp_router_id: 1.1.1.1
              
              bgp_neighbors:
                - neighbor: 10.0.1.3
                  remote_as: 65002
                  description: "gobgp1"
                - neighbor: 10.1.0.3
                  remote_as: 65003
                  description: "frr2"
                - neighbor: 10.1.0.4
                  remote_as: 65004
                  description: "frr3"
              
              backend_network_name: frr1-network
              backend_ip: 10.1.0.2
              backend_subnet: 10.1.0.0/24
              backend_hosts:
                - name: host1
                  ip: 10.1.0.10
                - name: frr2
                  ip: 10.1.0.3
                - name: frr3
                  ip: 10.1.0.4
              
              advertise_networks:
                - 10.1.0.0/24
              
              pim_interfaces:
                - eth1  # toward gobgp1
                - eth2  # toward frr1-network
              pim_rp_address: 10.1.0.2

            # frr2: Branch router 1, LHR
            frr2:
              ansible_host: 10.1.1.12
              bgp_as: 65003
              bgp_router_id: 3.3.3.3
              
              bgp_neighbors:
                - neighbor: 10.1.0.2
                  remote_as: 65001
                  description: "frr1"
              
              backend_network_name: frr2-network
              backend_ip: 10.2.0.2
              backend_subnet: 10.2.0.0/24
              backend_hosts:
                - name: receiver1
                  ip: 10.2.0.10
                - name: receiver2
                  ip: 10.2.0.20
              
              advertise_networks:
                - 10.2.0.0/24
              
              pim_interfaces:
                - eth1  # toward frr1-network
                - eth2  # toward frr2-network
              pim_rp_address: 10.1.0.2
              igmp_interfaces:
                - eth2

            # frr3: Branch router 2, LHR
            frr3:
              ansible_host: 10.1.1.14
              bgp_as: 65004
              bgp_router_id: 4.4.4.4
              
              bgp_neighbors:
                - neighbor: 10.1.0.2
                  remote_as: 65001
                  description: "frr1"
              
              backend_network_name: frr3-network
              backend_ip: 10.3.0.2
              backend_subnet: 10.3.0.0/24
              backend_hosts:
                - name: receiver3
                  ip: 10.3.0.10
                - name: receiver4
                  ip: 10.3.0.20
              
              advertise_networks:
                - 10.3.0.0/24
              
              pim_interfaces:
                - eth1  # toward frr1-network
                - eth2  # toward frr3-network
              pim_rp_address: 10.1.0.2
              igmp_interfaces:
                - eth2

        gobgp_routers:
          hosts:
            gobgp1:
              ansible_host: 10.1.1.13
              bgp_as: 65002
              bgp_router_id: 2.2.2.2
              
              bgp_neighbors:
                - neighbor: 10.0.1.2
                  remote_as: 65001
                  description: "frr1"
              
              backend_network_name: gobgp-network
              backend_ip: 10.4.0.2
              backend_subnet: 10.4.0.0/24
              backend_hosts:
                - name: host2
                  ip: 10.4.0.10

    hosts_group:
      hosts:
        host1:
          ansible_host: 10.1.1.20
          role: multicast_source
          data_ip: 10.1.0.10
          gateway: 10.1.0.2
          connected_router: frr1
          
        host2:
          ansible_host: 10.1.1.21
          role: endpoint
          data_ip: 10.4.0.10
          gateway: 10.4.0.2
          connected_router: gobgp1
          
        receiver1:
          ansible_host: 10.1.1.22
          role: multicast_receiver
          data_ip: 10.2.0.10
          gateway: 10.2.0.2
          connected_router: frr2
          
        receiver2:
          ansible_host: 10.1.1.23
          role: multicast_receiver
          data_ip: 10.2.0.20
          gateway: 10.2.0.2
          connected_router: frr2

        receiver3:
          ansible_host: 10.1.1.24
          role: multicast_receiver
          data_ip: 10.3.0.10
          gateway: 10.3.0.2
          connected_router: frr3

        receiver4:
          ansible_host: 10.1.1.25
          role: multicast_receiver
          data_ip: 10.3.0.20
          gateway: 10.3.0.2
          connected_router: frr3

