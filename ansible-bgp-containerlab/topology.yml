name: bgp-lab

mgmt:
  network: mgmt-net
  ipv4-subnet: 10.1.1.0/24

topology:
  nodes:
    automation:
      kind: linux
      image: network-automation:latest
      mgmt-ipv4: 10.1.1.10
    
    frr1:
      kind: linux
      image: frrouting/frr:latest
      mgmt-ipv4: 10.1.1.11
      exec:
        - sed -i 's/bgpd=no/bgpd=yes/' /etc/frr/daemons
        - sed -i 's/zebra=no/zebra=yes/' /etc/frr/daemons
        - /usr/lib/frr/frrinit.sh start
        - sed -i 's/https/http/g' /etc/apk/repositories #bypass ssl verification for package
        - apk add --no-cache --allow-untrusted openssh-server openssh-keygen openssh-client
        - mkdir -p /etc/ssh
        - ssh-keygen -A
        - sh -c "echo 'root:admin123' | chpasswd"
        - sh -c "echo 'PermitRootLogin yes' >> /etc/ssh/sshd_config"
        - sh -c "echo 'PasswordAuthentication yes' >> /etc/ssh/sshd_config"
        - /usr/sbin/sshd
    
    gobgp1:
      kind: linux
      image: jauderho/gobgp:latest
      mgmt-ipv4: 10.1.1.12
      cmd: gobgpd -f /dev/null --api-hosts=0.0.0.0:50051 --log-level=debug --log-plain

  # Links commented out - ContainerLab link creation fails on macOS
  # Data plane connectivity created by create-links.sh using Docker networks
  # links:
  #   - endpoints: ["frr1:eth1", "gobgp1:eth1"]

